<template1C xmlns="http://axelot.ru/esb/cc/2015/01" keepObjLink="true" name="ESW-1.БиблиотекаАлгоритмов.ФормированиеЗапросаДанных" type="Исходящая" version="0">
  <outgoingSettings objectType="ФормированиеЗапросаДанных"/>
  <code>//Секция препроцессорных переменных и инициализации параметров алгоритма&#13;
ЗадержкаЗапросаДанных = $ЗадержкаЗапросаДанных;&#13;
&#13;
//секция контекстной подсказки&#13;
Если Ложь Тогда //контекстная подсказка и контроль синтаксиса &#13;
	&#13;
	//РежимыВыполненияАлгоритма&#13;
	НенайденныеОбъектыРежим = "Заполнение";		//Заполнение списка ненайденных объектов&#13;
	НенайденныеОбъектыРежим = "Отправка";		//Формирование пакета с запросом данных&#13;
	&#13;
	//Переменные для контроля синтаксиса&#13;
	СсылкаДляПоиска = Неопределено; 			//Ссылка для проверки наличия объекта в базе&#13;
	ТипДанныхДляПоиска = ""; 					//Строка тип нененайденного объекта&#13;
	Значение = "";								//Строка - уникальный идентификатор для поиска&#13;
												//объекта в базе источнике&#13;
	&#13;
КонецЕсли;&#13;
&#13;
//////////////&#13;
Если НенайденныеОбъектыРежим = "Заполнение" Тогда&#13;
	//Запрос данных - заполняем список ненайденных объектов&#13;
	&#13;
	Если СсылкаДляПоиска.ПолучитьОбъект() = Неопределено  Тогда&#13;
		стрНенайденныеОбъекты = Новый Структура;&#13;
		стрНенайденныеОбъекты.Вставить("ТипДанных", ТипДанныхДляПоиска);&#13;
		стрНенайденныеОбъекты.Вставить("ЗначениеПоля", Значение);&#13;
		НенайденныеОбъектыМассив.Добавить(стрНенайденныеОбъекты);&#13;
	КонецЕсли;&#13;
	&#13;
ИначеЕсли НенайденныеОбъектыРежим = "Отправка" Тогда&#13;
	//Запрос данных - Формирование пакета с запросом данных и помещение&#13;
	//в очередь исходящих&#13;
	&#13;
	Если НенайденныеОбъектыМассив.Количество()&gt;0 Тогда&#13;
		&#13;
		СостояниеСообщения = Перечисления.сшпСтатусыСообщений.ОжиданиеОбработки;&#13;
		Задержка = ЗадержкаЗапросаДанных;&#13;
		&#13;
		Данные = Новый Структура;&#13;
		Данные.Вставить("ПоляЗапросаДанных", НенайденныеОбъектыМассив);&#13;
		&#13;
		ТипОбъектаСобытия = "ЗапросДанных";&#13;
		ЗначениеХранения = сшпОбщегоНазначения.ПреобразоватьСтруктуруПоФормату(ФорматСообщения, Данные);&#13;
		ФорматСериализация = Перечисления.сшпФорматыСообщений.XML;&#13;
		МетодХранения = Перечисления.сшпМетодХранения.ПоСсылке;&#13;
		&#13;
		сшпРаботаСДанными.ПоместитьВОчередьИсходящих(ТипОбъектаСобытия, ЗначениеХранения, ФорматСериализация, МетодХранения);&#13;
		&#13;
		ЗаписьЖурналаРегистрации(&#13;
		"Datareon. ЗапросДанных", УровеньЖурналаРегистрации.Предупреждение,, &#13;
		Идентификатор, "Тело пакета с запросом данных: " + ЗначениеХранения&#13;
		);&#13;
		&#13;
	КонецЕсли;	&#13;
	&#13;
	&#13;
КонецЕсли;&#13;
</code>
  <comment/>
  <variables>
    <variable comment="" default="300" name="ЗадержкаЗапросаДанных" type="Число"/>
  </variables>
</template1C>
